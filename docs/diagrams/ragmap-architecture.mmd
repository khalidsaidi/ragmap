%%{init: {"theme":"base","themeVariables":{"primaryColor":"#ffffff","primaryTextColor":"#000000","primaryBorderColor":"#000000","lineColor":"#000000","secondaryColor":"#ffffff","tertiaryColor":"#ffffff","clusterBkg":"#ffffff","clusterBorder":"#000000","edgeLabelBackground":"#ffffff"},"flowchart":{"curve":"linear","nodeSpacing":60,"rankSpacing":120}}}%%
flowchart TB
  %% Concept-only diagram (shows product value; no deployment/framework/datastore details)

  classDef mono fill:#ffffff,stroke:#000000,color:#000000,stroke-width:1px;

  Sources["Upstream MCP registries\n(official + optional)"]:::mono
  Sync["Sync + normalize\n(read-only)"]:::mono
  Catalog["Enriched catalog\n(server records + versions)"]:::mono

  Cap["Structured metadata\n(domain, retrieval, freshness,\ngrounding, privacy, auth, limits)\n\nExamples:\n- domain: docs|code|web|mixed\n- retrieval: dense|sparse|hybrid\n  (+rerank)\n- freshness: static|continuous\n  (max lag)\n- grounding: citations\n  provenance fields\n- privacy: local|remote\n  stores user data?\n- auth: req|optional\n  methods\n- limits: top_k|rate\n  max context"]:::mono

  Trust["Trust signals (lightweight)\n- upstream status\n- reachability/latency\n- schema stability\n- reports (optional)"]:::mono

  Router["Router\nmatch + rank + explain"]:::mono
  Ranked["Ranked candidates\n+ reasons"]:::mono
  Retrieval["Chosen retrieval MCP server(s)\n(do retrieval)"]:::mono

  Users["Agents + humans"]:::mono
  Tools["MCP tools\nrag_find_servers\nrag_get_server\nrag_list_categories\nrag_explain_score"]:::mono
  Criteria["Routing constraints\n(domain, privacy, citations,\nfreshness, auth, limits, ...)"]:::mono

  Sources --> Sync --> Catalog --> Router --> Ranked --> Retrieval
  Catalog --> Cap
  Catalog --> Trust
  Users --> Tools --> Criteria --> Router
