%%{init: {"theme":"base","themeVariables":{"primaryColor":"#ffffff","primaryTextColor":"#000000","primaryBorderColor":"#000000","lineColor":"#000000","secondaryColor":"#ffffff","tertiaryColor":"#ffffff","clusterBkg":"#ffffff","clusterBorder":"#000000","edgeLabelBackground":"#ffffff"},"flowchart":{"curve":"linear","nodeSpacing":60,"rankSpacing":120}}}%%
flowchart TB
  %% Concept-only diagram (shows product value; no deployment/framework/datastore details)

  classDef mono fill:#ffffff,stroke:#000000,color:#000000,stroke-width:1px;

  Sources["Upstream MCP registries<br/>(official + optional)"]:::mono
  Sync["Sync + normalize<br/>(read-only)"]:::mono
  Catalog["Enriched catalog<br/>(server records + versions)"]:::mono

  Cap["Structured metadata<br/>(domain, retrieval, freshness,<br/>grounding, privacy, auth, limits)<br/><br/>Examples:<br/>- domain: docs|code|web|mixed<br/>- retrieval: dense|sparse|hybrid<br/>  (+rerank)<br/>- freshness: static|continuous<br/>  (max lag)<br/>- grounding: citations<br/>  provenance fields<br/>- privacy: local|remote<br/>  stores user data?<br/>- auth: req|optional<br/>  methods<br/>- limits: top_k|rate<br/>  max context"]:::mono

  Trust["Trust signals (lightweight)<br/>- upstream status<br/>- reachability/latency<br/>- schema stability<br/>- reports (optional)"]:::mono

  Router["Router<br/>match + rank + explain"]:::mono
  Ranked["Ranked candidates<br/>+ reasons"]:::mono
  Retrieval["Chosen retrieval MCP server(s)<br/>(do retrieval)"]:::mono

  Users["Agents + humans"]:::mono
  Tools["MCP tools<br/>rag_find_servers<br/>rag_get_server<br/>rag_list_categories<br/>rag_explain_score"]:::mono
  Criteria["Routing constraints<br/>(domain, privacy, citations,<br/>freshness, auth, limits, ...)"]:::mono

  Sources --> Sync --> Catalog --> Router --> Ranked --> Retrieval
  Catalog --> Cap
  Catalog --> Trust
  Users --> Tools --> Criteria --> Router
